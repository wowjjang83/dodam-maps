<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dodam Maps</title>
    <link rel="stylesheet" href="css/style.css">
    
    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ol@v7.1.0/dist/ol.js"></script>
    <!--<script src="http://openlayers.org/en/master/build/ol.js"></script>-->
    <script src="http://map.vworld.kr/js/apis.do?type=Base&apiKey=429F4193-A25C-31FF-9695-4BE5FE4E43AD&
    domain=localhost"></script>
    <script src="https://kit.fontawesome.com/415777b3d1.js" crossorigin="anonymous"></script>
    <script defer src="js/apiData.js"></script>
    <script defer src="js/map.js"></script>
</head>
<body>
    <main>
        <nav>
            <img src="img/dodam_logo_footer.png" alt="Dodam Maps">
            <div class="sch">
                <!-- 검색 옵션 태그 추가 -->
                <select id="sch-opt">
                    <!--<option value="">검색옵션</option>-->
                    <option value="ADDRESS">주소</option>
                    <option value="PLACE">장소</option>
                    <!--
                    <option value="DISTRICT">행정구역</option>
                    -->
                </select>
                <select id="addr-opt-detail">
                    <option value="PARCEL">지번</option>
                    <option value="ROAD">도로명</option>
                </select>
                <!-- 행정구역은 중지
                <select id="dist-opt-detail">
                    <option value="L1">시/도</option>
                    <option value="L2">시/군/구</option>
                    <option value="L3">일반구</option>
                    <option value="L4">읍면동</option>
                </select>
                -->
                <input type="text" placeholder="검색어를 입력하세요">
                <div class="list-box">
                    <ul id="searchAddrList" class="search-list"></ul>
                </div>
                <button type="button">
                    <i class="fas fas fa-search"></i>
                </button>
            </div>
            <div class="right">
                <span id="login-msg"  status="out"></span>
                <a id="main-login-btn" href="#">
                    <img src="img/login.png" alt="로그인">
                </a>
            </div>
        </nav>
        <aside>
            <ul>
                <li>
                    <a href="#">
                        <img src="img/zone_icon.png" alt="구역계 설정">
                    </a>
                </li>
            </ul>
            <div class="help">
                <a href="#">
                    <i class="fas fa-info-circle"></i>
                </a>
            </div>
        </aside>
        <div class="con">
            <div id="vwmap"></div>
        </div>
    </main>

    <div class="login">
        <div class="logo">
            <img src="img/dodam_logo_footer.png" alt="Dodam Maps">
        </div>
        <div class="close-btn">
            <button id="login-close" type="button">
                <i class="fa-solid fa-xmark"></i>
            </button>
        </div>
        <div class="login-box">
            <div class="login-title">
                <h2><b>Dodam Maps</b> 의컨텐츠를</h2>
                <p>이용하실려면 로그인을 해야합니다.</p>
            </div>
            <div class="login-con">
                <div class="login-input">
                    <input type="text" placeholder="아이디를 입력해 주세요">
                    <input type="password" placeholder="비밀번호를 입력해 주세요">
                </div>
                <div class="login-btn">
                    <button type="button">Dodam Maps 로그인</button>
                </div>
                <div class="login-find-link">
                    <a href="#">아이디 찾기</a> | 
                    <a href="#">비밀번호 찾기</a> | 
                    <a href="#">회원가입</a>
                </div>
                <div class="login-sns">
                    <div class="kakao-btn">
                        <button type="button"></button>
                    </div>
                    <div class="naver-btn">
                        <button type="button"></button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function(){
            vwmapCreate("vwmap");

            // 로그인 버튼 크릭
            $('#main-login-btn').click(function(){
                if($('#login-msg').attr('status') == 'in'){
                    // 로그인상태 > 로그아웃 alert 띄우기
                    if(confirm('로그아웃 하시겠습니까?')){
                        // #login-msg status 속성에 값 out으로 수정
                        $('#login-msg').attr('status', 'out');
                        // .right span에 로그인한 아이디 출력
                        $('.right span').html("");

                        // .right a img 이미지를 로그아웃 이미지로 변경
                        $('.right a img').attr('src', 'img/login.png');
                    }
                }else{
                    // 로그아웃상태 > 로그인창 레이어 팝업
                    $('.login').css('display', 'block');
                    $('.login').animate({
                        opacity: 1
                    }, 300);

                    // #login-msg status 속성에 값 in으로 수정
                    $('#login-msg').attr('status', 'in');
                }
            });

            // 로그인창 닫기 버튼 클릭
            $('#login-close').click(function(){
                $('.login').animate({
                    opacity: 0
                }, 300, function(){
                    $('.login').css('display', 'none');
                });
            });

            // 로그인창 로그인 클릭
            $('.login-btn button').click(function(){
                // 로그인
                // .right span에 로그인한 아이디 출력
                $('.right span').html("<b><a id='mb-name' href='#''>테스터</a></b>님 안녕하세요.");

                // .right a img 이미지를 로그아웃 이미지로 변경
                $('.right a img').attr('src', 'img/logout.png');

                // 로그인창 닫기
                $('#login-close').click();
            });

            // 주소검색
            $('.sch button').click(function(){
                //console.log('검색버튼 클릭');
                var search = $('.sch input').val();
                if(search == ''){
                    alert('검색어를 입력해주세요.');
                }else{

                    var _opt1 = $('#sch-opt').val();
                    var _opt2 = "";
                    if(_opt1 == "ADDRESS"){
                        _opt2 = $('#addr-opt-detail').val();
                    }else if(_opt1 == "DISTRICT"){
                        _opt2 = $('#dist-opt-detail').val();
                    }

                    // 주소검색
                    vwmapSearchAddr(_opt1, _opt2, search);
                }
            });

            // 주소검색 엔터키
            $('.sch input').keydown(function(key){
                if(key.keyCode == 13){
                    //console.log('엔터키 클릭');
                    var search = $('.sch input').val();
                    if(search == ''){
                        alert('검색어를 입력해주세요.');
                    }else{
                        var _opt1 = $('#sch-opt').val();
                        var _opt2 = "";
                        if(_opt1 == "ADDRESS"){
                            _opt2 = $('#addr-opt-detail').val();
                        }else if(_opt1 == "DISTRICT"){
                            _opt2 = $('#dist-opt-detail').val();
                        }

                        // 주소검색
                        vwmapSearchAddr(_opt1, _opt2, search);
                    }
                }
            });

            // 주소검색 입력할때마다 리스트 출력
            $('.sch input').keyup(function(){
                var _keyword = $('.sch input').val();
                if(_keyword == ''){
                    //console.log('검색어 없음');
                    //$('.sch .search-list').remove();
                    $('.sch .search-list').css('display', 'none');
                }else{
                    //console.log('검색어 있음');
                    // search 글자가 3글자 이상
                    if(_keyword.length >= 3){
                        $('.sch .search-list').css('display', 'block');

                        var _opt1 = $('#sch-opt').val();
                        var _opt2 = "";
                        if(_opt1 == "ADDRESS"){
                            _opt2 = $('#addr-opt-detail').val();
                        }else if(_opt1 == "DISTRICT"){
                            _opt2 = $('#dist-opt-detail').val();
                        }

                        // 주소검색 리스트 출력
                        vwmapSearchAddrList(_opt1, _opt2, _keyword);
                    }
                }
            });

            let sch_focus = false;
            let sch_opt = "";

            // $('#sch-opt') select option 변경시
            $('#sch-opt').change(function(){
                sch_opt = $('#sch-opt').val();
                $('.sch input').val("");
                $("#searchAddrList").empty();

                if($('#sch-opt').val() == "ADDRESS"){
                    $('.sch .search-list').css('left', '208px');
                    $('#addr-opt-detail').css('display', 'inline-block');
                    $('#dist-opt-detail').css('display', 'none');
                }else if($('#sch-opt').val() == "PLACE"){
                    $('.sch .search-list').css('left', '104px');
                    $('#addr-opt-detail').css('display', 'none');
                    $('#dist-opt-detail').css('display', 'none');
                }else if($('#sch-opt').val() == "DISTRICT"){
                    $('.sch .search-list').css('left', '208px');
                    $('#dist-opt-detail').css('display', 'inline-block');
                    $('#addr-opt-detail').css('display', 'none');
                }else{
                    $('.sch .search-list').css('left', '104px');
                    $('#addr-opt-detail').css('display', 'none');
                    $('#dist-opt-detail').css('display', 'none');
                }
            });            
            
            //
            $('.sch input').focusout(function() {
                // this display none
                //$('.sch .search-list').css('display', 'none');
                // 3초후에 display none
                setTimeout(function(){
                    if(sch_focus == true){
                        sch_focus = false;
                        $('.sch .search-list').css('display', 'none');
                    }
                }, 300);
            });

            
            // input 창으로 focus가 들어올때  event
            $('.sch input').focusin(function() {
                // this display block
                $('.sch .search-list').css('display', '');
                sch_focus = true;
            });

            // $('.sch input') 클릭시
            $('.sch input').click(function(){
                /*
                console.log($('#sch-opt').val()+" / "+sch_opt);
                if($('#sch-opt').val() != sch_opt){
                    $("#searchAddrList").empty();
                }
                */
                $('.sch .search-list').css('display', 'block');
                sch_focus = true;
            });
        });
    </script>
</body>
</html>