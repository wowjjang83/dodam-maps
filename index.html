<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dodam Maps</title>
    <link rel="stylesheet" href="css/style.css">
    
    <!-- jQuery library -->
    <!-- 예전맵 API 쓸때 필요한것들
    <script src="https://cdn.jsdelivr.net/npm/ol@v7.1.0/dist/ol.js"></script>
    
    <script src="http://map.vworld.kr/js/apis.do?type=Base&apiKey=DD59541F-5495-3F50-98F3-54BB5947859C&
    domain=localhost"></script>
    -->

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <script type="text/javascript" src="https://map.vworld.kr/js/vworldMapInit.js.do?version=2.0&apiKey=DD59541F-5495-3F50-98F3-54BB5947859C&domain=wowjjang83.github.io"></script>
    
    <script defer src="js/apiData.js"></script>
    <!--
    <script defer src="js/map.js"></script>
    -->
    <script defer src="js/newmap2d20.js"></script> 

    <script defer src="https://kit.fontawesome.com/415777b3d1.js" crossorigin="anonymous"></script>
    
    
</head>
<body>
    <main>
        <nav>
            <img src="img/dodam_logo_footer.png" alt="Dodam Maps">
            <div class="sch">
                <!-- 검색 옵션 태그 추가 -->
                <select id="sch-opt">
                    <!--<option value="">검색옵션</option>-->
                    <option value="ADDRESS">주소</option>
                    <option value="PLACE">장소</option>
                    <!--
                    <option value="DISTRICT">행정구역</option>
                    -->
                </select>
                <select id="addr-opt-detail">
                    <option value="PARCEL">지번</option>
                    <option value="ROAD">도로명</option>
                </select>
                <!-- 행정구역은 중지
                <select id="dist-opt-detail">
                    <option value="L1">시/도</option>
                    <option value="L2">시/군/구</option>
                    <option value="L3">일반구</option>
                    <option value="L4">읍면동</option>
                </select>
                -->
                <input type="text" placeholder="검색어를 입력하세요">
                <div class="list-box">
                    <ul id="searchAddrList" class="search-list"></ul>
                </div>
                <button type="button">
                    <i class="fas fas fa-search"></i>
                </button>
            </div>
            <div class="right">
                <span id="login-msg"  status="out"></span>
                <a id="main-login-btn" href="#">
                    <img src="img/login.png" alt="로그인">
                </a>
            </div>
        </nav>
        <aside>
            <ul>
                <li>
                    <a id="zone-pop-icon" href="#">
                        <img src="img/zone_icon.png" alt="구역계 설정">
                    </a>
                </li>
            </ul>
            <div class="help">
                <a href="#">
                    <i class="fas fa-info-circle"></i>
                </a>
            </div>
        </aside>
        <div class="zone-pop">            
            <div class="tab-ui">
                <ul>
                    <li>
                        <a href="#" idx="1" status="active">
                            <i class="fa-sharp fa-solid fa-location-dot"></i>
                            <p>위치</p>
                            <span>
                                <i class="fa-solid fa-caret-up"></i>
                            </span>
                        </a>
                    </li>
                    <li>
                        <a href="#" idx="2" status="">
                            <i class="fa-sharp fa-solid fa-earth-americas"></i>
                            <p>토지</p>
                            <span>
                                <i class="fa-solid fa-caret-up"></i>
                            </span>
                        </a>
                    </li>
                    <li>
                        <a href="#" idx="3" status="">
                            <i class="fa-solid far fa-building"></i>
                            <p>건축</p>
                            <span>
                                <i class="fa-solid fa-caret-up"></i>
                            </span>
                        </a>
                    </li>
                    <li>
                        <a href="#" idx="4" status="">
                            <i class="fa-duotone fas fa-chart-pie"></i>
                            <p>도시<br>계획</p>
                            <span>
                                <i class="fa-solid fa-caret-up"></i>
                            </span>
                        </a>
                    </li>
                </ul>
            </div>
            <div class="title">
                <h2>구역계설정</h2>
                <button type="button">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            <div class="con">
                <section class="sec1">
                    <h3>예상 차감 면적</h3>
                    <p>
                        선택된 구역계 면적 0㎡ ※구역계 편입 유무에 따라 분석면적과 다를 수 있음<br>
                        필지수 <span><a href="#">0</a></span> 필지<br>
                        차감 면적 <span><a href="#">0</a></span> ㎡
                    </p>
                </section>
                <section class="sec2">
                    <h3>소재지</h3>
                    <div class="con">
                        <table>
                            <tr>
                                <th>주소</th>
                                <th>면적㎡</th>
                                <th>편입상태</th>
                                <th>위치</th>
                            </tr>
                            <tr>
                                <td colspan="4">데이터가 없습니다.</td>
                            </tr>
                        </table>
                        <div class="pg">&lt; &gt;</div>
                    </div>
                </section>
            </div>

        </div>
        <div class="latest-list-pop">
            <button class="close-btn" type="button">
                <i class="fa-solid fa-xmark"></i>
            </button>
            <article class="art1">
                <div class="title">
                    <h3>최근 주소검색 리스트</h3>
                </div>
                <div class="list-box">
                    <ul>
                        <li>
                            <a href="#">
                                대전 유성구 학하서로 111 한밭대앞셀프주유소<br>대전 유성구 덕명동 613-1
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                대전 유성구 학하서로 111 한밭대앞셀프주유소<br>대전 유성구 덕명동 613-1
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                대전 유성구 학하서로 111 한밭대앞셀프주유소<br>대전 유성구 덕명동 613-1
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                대전 유성구 학하서로 111 한밭대앞셀프주유소<br>대전 유성구 덕명동 613-1
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                대전 유성구 학하서로 111 한밭대앞셀프주유소<br>대전 유성구 덕명동 613-1
                            </a>
                        </li>
                    </ul>
                </div>                
            </article>
            <article class="art2">
                <div class="title">
                    <h3>최근 구역계 저장 리스트</h3>
                </div>
                <div class="list-box">
                    <ul>
                        <li>
                            <a href="#">
                                대전 유성구 학하서로 111 한밭대앞셀프주유소<br>대전 유성구 덕명동 613-1
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                대전 유성구 학하서로 111 한밭대앞셀프주유소<br>대전 유성구 덕명동 613-1
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                대전 유성구 학하서로 111 한밭대앞셀프주유소<br>대전 유성구 덕명동 613-1
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                대전 유성구 학하서로 111 한밭대앞셀프주유소<br>대전 유성구 덕명동 613-1
                            </a>
                        </li>
                    </ul>
                </div>
                <div class="more">
                    <a href="#">
                        +더보기
                    </a>
                </div>                
            </article>
        </div>
        <div class="map-con">
            <div class="title">
                <h1>주소나 장소명 타이틀</h1>
                <span class="setup-menu">
                    <ul>
                        <li>
                            <a href="#" id="zone-setup-link" active="false">구역계 설정</a>
                        </li>
                    </ul>
                </span>
            </div>
            <div class="map-mode">
                <ul>
                    <li id="map-mode-li-1">
                        <a href="javascript:setMapMode(vw.ol3.BasemapType.GRAPHIC,1)" active="false">기본지도</a>
                    </li>
                    <li id="map-mode-li-2">
                        <a href="javascript:setMapMode(vw.ol3.BasemapType.PHOTO,2)" active="false">항공뷰</a>
                    </li>
                    <li id="map-mode-li-3">
                        <a href="javascript:setMapMode(vw.ol3.BasemapType.PHOTO_HYBRID,3)" active="true">하이브리드</a>
                    </li>
                </ul>
            </div>
            <div id="vwmap"></div>
        </div>
    </main>

    <div class="login">
        <div class="logo">
            <img src="img/dodam_logo_footer.png" alt="Dodam Maps">
        </div>
        <div class="close-btn">
            <button id="login-close" type="button">
                <i class="fa-solid fa-xmark"></i>
            </button>
        </div>
        <div class="login-box">
            <div class="login-title">
                <h2><b>Dodam Maps</b> 의컨텐츠를</h2>
                <p>이용하실려면 로그인을 해야합니다.</p>
            </div>
            <div class="login-con">
                <div class="login-input">
                    <input type="text" placeholder="아이디를 입력해 주세요">
                    <input type="password" placeholder="비밀번호를 입력해 주세요">
                </div>
                <div class="login-btn">
                    <button type="button">Dodam Maps 로그인</button>
                </div>
                <div class="login-find-link">
                    <a href="#">아이디 찾기</a> | 
                    <a href="#">비밀번호 찾기</a> | 
                    <a href="#">회원가입</a>
                </div>
                <div class="login-sns">
                    <div class="kakao-btn">
                        <button type="button"></button>
                    </div>
                    <div class="naver-btn">
                        <button type="button"></button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function(){

            // 로그인 버튼 클릭
            $('#main-login-btn').click(function(){
                if($('#login-msg').attr('status') == 'in'){
                    // 로그인상태 > 로그아웃 alert 띄우기
                    if(confirm('로그아웃 하시겠습니까?')){
                        // #login-msg status 속성에 값 out으로 수정
                        $('#login-msg').attr('status', 'out');
                        // .right span에 로그인한 아이디 출력
                        $('.right span').html("");

                        // .right a img 이미지를 로그아웃 이미지로 변경
                        $('.right a img').attr('src', 'img/login.png');
                    }
                }else{
                    // 로그아웃상태 > 로그인창 레이어 팝업
                    $('.login').css('display', 'block');
                    $('.login').animate({
                        opacity: 1
                    }, 300);

                    // #login-msg status 속성에 값 in으로 수정
                    $('#login-msg').attr('status', 'in');
                }
            });

            // 로그인창 닫기 버튼 클릭
            $('#login-close').click(function(){
                $('.login').animate({
                    opacity: 0
                }, 300, function(){
                    $('.login').css('display', 'none');
                });
            });

            // 로그인창 로그인 클릭
            $('.login-btn button').click(function(){
                // 로그인
                // .right span에 로그인한 아이디 출력
                $('.right span').html("<b><a id='mb-name' href='#''>테스터</a></b>님 안녕하세요.");

                // .right a img 이미지를 로그아웃 이미지로 변경
                $('.right a img').attr('src', 'img/logout.png');

                // 로그인창 닫기
                $('#login-close').click();
            });

            // 주소검색
            $('.sch button').click(function(){
                //console.log('검색버튼 클릭');
                var search = $('.sch input').val();
                if(search == ''){
                    alert('검색어를 입력해주세요.');
                }else{

                    var _opt1 = $('#sch-opt').val();
                    var _opt2 = "";
                    if(_opt1 == "ADDRESS"){
                        _opt2 = $('#addr-opt-detail').val();
                    }else if(_opt1 == "DISTRICT"){
                        _opt2 = $('#dist-opt-detail').val();
                    }

                    // 주소검색
                    vwmapSearchAddr(_opt1, _opt2, search);
                }
            });

            // 주소검색 엔터키
            $('.sch input').keydown(function(key){
                if(key.keyCode == 13){
                    //console.log('엔터키 클릭');
                    var search = $('.sch input').val();
                    if(search == ''){
                        alert('검색어를 입력해주세요.');
                    }else{
                        var _opt1 = $('#sch-opt').val();
                        var _opt2 = "";
                        if(_opt1 == "ADDRESS"){
                            _opt2 = $('#addr-opt-detail').val();
                        }else if(_opt1 == "DISTRICT"){
                            _opt2 = $('#dist-opt-detail').val();
                        }

                        // 주소검색
                        vwmapSearchAddr(_opt1, _opt2, search);
                        
                    }
                }
            });

            // 주소검색 입력할때마다 리스트 출력
            $('.sch input').keyup(function(){
                var _keyword = $('.sch input').val();
                if(_keyword == ''){
                    //console.log('검색어 없음');
                    //$('.sch .search-list').remove();
                    $('.sch .search-list').css('display', 'none');
                }else{
                    //console.log('검색어 있음');
                    // search 글자가 3글자 이상
                    if(_keyword.length >= 3){
                        $('.sch .search-list').css('display', 'block');

                        var _opt1 = $('#sch-opt').val();
                        var _opt2 = "";
                        if(_opt1 == "ADDRESS"){
                            _opt2 = $('#addr-opt-detail').val();
                        }else if(_opt1 == "DISTRICT"){
                            _opt2 = $('#dist-opt-detail').val();
                        }

                        // 주소검색 리스트 출력
                        vwmapSearchAddrList(_opt1, _opt2, _keyword);
                    }else{
                        hdTitleOnOf("off");
                    }
                }
            });

            let sch_focus = false;
            let sch_opt = "";
            let sch_opt2 = "";

            // $('#sch-opt') select option 변경시
            $('#sch-opt').change(function(){
                if($('#sch-opt').val() != sch_opt){
                    // 타이틀 Off
                    hdTitleOnOf("off");
                }

                sch_opt = $('#sch-opt').val();
                $('.sch input').val("");
                $("#searchAddrList").empty();

                schInputHolderTxt();

                if($('#sch-opt').val() == "ADDRESS"){
                    $('.sch .search-list').css('left', '208px');
                    $('#addr-opt-detail').css('display', 'inline-block');
                    $('#dist-opt-detail').css('display', 'none');                   
                }else if($('#sch-opt').val() == "PLACE"){
                    $('.sch .search-list').css('left', '104px');
                    $('#addr-opt-detail').css('display', 'none');
                    $('#dist-opt-detail').css('display', 'none');
                }else if($('#sch-opt').val() == "DISTRICT"){
                    $('.sch .search-list').css('left', '208px');
                    $('#dist-opt-detail').css('display', 'inline-block');
                    $('#addr-opt-detail').css('display', 'none');
                }else{
                    $('.sch .search-list').css('left', '104px');
                    $('#addr-opt-detail').css('display', 'none');
                    $('#dist-opt-detail').css('display', 'none');
                }

                // 포커스 input
                $('.sch input').focus();
            });
            $('#addr-opt-detail').change(function(){
                schInputHolderTxt();

                if($('#addr-opt-detail').val() != sch_opt2){
                    hdTitleOnOf("off");
                    $('.sch input').val("");
                    $("#searchAddrList").empty();
                }

                sch_opt2 = $('#addr-opt-detail').val();

                // 포커스 input
                $('.sch input').focus();
            });

            // 타이틀 On/Off
            function hdTitleOnOf(_val){
                if(_val == "on"){
                    // 타이틀 On
                    $('.map-con .title').animate({
                        top: 50
                    },500);
                    
                }else if(_val == "off"){
                    // 타이틀 Off
                    $('.map-con .title').animate({
                        top: 0
                    },500);

                    // 맵에 툴바 비활성
                    $('.vw-toolbar').animate({
                        top: 0,
                        opacity: 0
                    },500);
                }
            }

            function schInputHolderTxt(){
                var _txt1 = "";
                var _txt2 = "";
                
                if($('#sch-opt').val()=="ADDRESS"){
                    _txt1 = "주소";

                    if($('#addr-opt-detail').val()=="PARCEL"){
                        _txt2 = "지번";
                    }else if($('#addr-opt-detail').val()=="ROAD"){
                        _txt2 = "도로명";
                    }

                    
                    $('.sch input').attr('placeholder', _txt1+'('+_txt2+')를 입력해주세요');
                }else if($('#sch-opt').val()=="PLACE"){
                    _txt1 = "장소";

                    $('.sch input').attr('placeholder', _txt1+'를 입력해주세요'); 
                }

                if(_txt1 == ""){
                    $('.sch input').attr('placeholder', '옵션을 선택해주세요');    
                }
            }
            
            //
            $('.sch input').focusout(function() {
                // this display none
                //$('.sch .search-list').css('display', 'none');
                // 3초후에 display none
                setTimeout(function(){
                    if(sch_focus == true){
                        sch_focus = false;
                        $('.sch .search-list').css('display', 'none');
                    }
                }, 300);
            });

            
            // input 창으로 focus가 들어올때  event
            $('.sch input').focusin(function() {
                // this display block
                $('.sch .search-list').css('display', '');
                sch_focus = true;
            });

            // $('.sch input') 클릭시
            $('.sch input').click(function(){
                /*
                console.log($('#sch-opt').val()+" / "+sch_opt);
                if($('#sch-opt').val() != sch_opt){
                    $("#searchAddrList").empty();
                }
                */
                $('.sch .search-list').css('display', 'block');
                sch_focus = true;
            });

            // 최근리스트 팝업 활성
            $("#zone-pop-icon").click(function(){
                $('.latest-list-pop').css('display', 'block');
                $('.latest-list-pop').animate({
                    opacity: 1,
                    left: 55
                },300);
            });

            // 최근리스트 팝업 비활성
            $('.latest-list-pop .close-btn').click(function(){
                $('.latest-list-pop').animate({
                    opacity: 0,
                    left: 100
                },300, function(){
                    $('.latest-list-pop').css('display', 'none');
                });
            });

            // 구역계창 닫기 버튼 클릭
            $('.zone-pop .title button').click(function(){

                $('.zone-pop').animate({
                    opacity: 0,
                    right: 50
                },300, function(){
                    $('.zone-pop').css('display', 'none');
                });

                var _txt = $('#zone-setup-link').text();
                _txt = _txt.replace("[ ","");
                _txt = _txt.replace(" ]","");
                $('#zone-setup-link').text(_txt);
                $('#zone-setup-link').attr("active","false");
            });

            // 구역계설정 팝업
            $('#zone-setup-link').click(function(){
                if($(this).attr("active") == "false"){
                    var _txt = $(this).text();
                    _txt = "[ "+_txt+" ]";
                    $(this).text(_txt);
                    $(this).attr("active","true");

                    // 구역계 팝업
                    //$("#zone-pop-icon").click();
                    
                    $('.zone-pop').css('display', 'block');
                    $('.zone-pop').animate({
                        opacity: 1,
                        right: 5
                    },500);
                    
                }
            });

            // 구역계설정 탭메뉴 클릭시
            $('.zone-pop .tab-ui a').click(function(){
                var _idx = parseInt($(this).attr("idx"));

                // status 가 active 인 .zone-pop .tab-ui a 의 idx 값을 구한다.
                var _active_li = $('.zone-pop .tab-ui a[status="active"]').parent();

                if($(this).attr("status") != "active"){
                    _active_li.css("border","none");
                    // _active_li 의 a>p, span css 변경
                    _active_li.find("a>p, span").css("display","none");
                    _active_li.find("a").css("top","0");
                    
                    $('.zone-pop .tab-ui a[status="active"]').attr("status","");
                    $(this).attr("status","active");

                    $(this).parent().find("a>p").css("display","block");
                    $(this).parent().find("span").css("display","inline");
                    

                    if(_idx == 1){
                        // 위치
                        $(this).parent().css("border-bottom","1px solid #2f5597");
                    }else if(_idx == 2){
                        // 토지
                        $(this).parent().css("border-top","1px solid #2f5597");
                        $(this).parent().css("border-bottom","1px solid #2f5597");

                        $(this).css("top","15px");
                    }else if(_idx == 3){
                        // 건축
                        $(this).parent().css("border-top","1px solid #2f5597");
                        $(this).parent().css("border-bottom","1px solid #2f5597");

                        $(this).css("top","15px");
                    }else if(_idx == 4){
                        // 도시계획
                        $(this).parent().css("border-top","1px solid #2f5597");

                        $(this).css("top","15px");
                    }
                }
            });

            // 맵 모드
            function mapModeActive(_val){
                
            }

            // 초기실행
            //$('.map-con .title span a').addClass('a.hover');
            schInputHolderTxt();
            // 포커스 input
            $('.sch input').focus();

            //vwmapCreate("vwmap");
            vwmapBaseCreate("vwmap");
        });
    </script>
</body>
</html>